<!--
  This component displays a modal form for adding a new machine.
  It includes input fields for machine details, form validation, 
  success/error alerts, and submit/cancel actions.
-->

<div class="modal-overlay" (click)="onCancel()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <div class="header-content">
        <div class="header-icon">
          <i class="material-icons">precision_manufacturing</i>
        </div>
        <div class="header-text">
          <h2>Add New Machine</h2>
          <p class="header-subtitle">Fill in the required machine details</p>
        </div>
      </div>
      <button class="close-btn" (click)="onCancel()">
        <i class="material-icons">close</i>
      </button>
    </div>

    <!-- Error Alert in Modals -->
    @if (error) {
      <div class="error-alert">
        <div class="alert-icon">
          <i class="material-icons">error</i>
        </div>
        <div class="alert-content">
          <strong>Error</strong>
          <span>{{ error }}</span>
        </div>
        <button class="alert-dismiss" (click)="error = null">
          <i class="material-icons">close</i>
        </button>
      </div>
    }

    <!-- Success Alert -->
    @if (successMessage) {
      <div class="success-alert">
        <div class="alert-icon">
          <i class="material-icons">check_circle</i>
        </div>
        <div class="alert-content">
          <strong>Success</strong>
          <span>{{ successMessage }}</span>
        </div>
        <button class="alert-dismiss" (click)="successMessage = null">
          <i class="material-icons">close</i>
        </button>
      </div>
    }

    <form [formGroup]="machineForm" (ngSubmit)="onSubmit()" class="add-machine-form">
      
      <!-- Machine Details Card -->
      <div class="form-card">
        <div class="card-header">
          <div class="card-header-content">
            <div class="card-icon">
              <i class="material-icons">info</i>
            </div>
            <div class="card-title-section">
              <h3>Machine Details</h3>
              <p class="card-subtitle">Enter all required machine information</p>
            </div>
          </div>
          <div class="completion-indicator" *ngIf="isFormComplete()">
            <i class="material-icons">check_circle</i>
          </div>
        </div>
        <div class="card-body">
          <div class="form-grid">
            <div class="form-group">
              <label for="name">
                <i class="material-icons label-icon">badge</i>
                Machine Name <span class="required">*</span>
              </label>
              <div class="input-wrapper">
                <input 
                  type="text" 
                  id="name"
                  class="form-control"
                  [class.is-invalid]="isFieldInvalid('name')"
                  [class.is-valid]="isFieldValid('name')"
                  formControlName="name"
                  placeholder="Enter machine name">
                <div class="input-icon" *ngIf="isFieldValid('name')">
                  <i class="material-icons">check</i>
                </div>
              </div>
              @if (isFieldInvalid('name')) {
                <div class="invalid-feedback">
                  <i class="material-icons">error</i>
                  {{ getFieldError('name') }}
                </div>
              }
            </div>
            
            <div class="form-group">
              <label for="operatorName">
                <i class="material-icons label-icon">person</i>
                Operator Name <span class="optional">(Optional)</span>
              </label>
              <div class="input-wrapper">
                <input 
                  type="text" 
                  id="operatorName"
                  class="form-control"
                  [class.is-invalid]="isFieldInvalid('operatorName')"
                  [class.is-valid]="isFieldValid('operatorName')"
                  formControlName="operatorName"
                  placeholder="Enter operator name">
                <div class="input-icon" *ngIf="isFieldValid('operatorName')">
                  <i class="material-icons">check</i>
                </div>
              </div>
              @if (isFieldInvalid('operatorName')) {
                <div class="invalid-feedback">
                  <i class="material-icons">error</i>
                  {{ getFieldError('operatorName') }}
                </div>
              }
            </div>

            <div class="form-group">
              <label for="model">
                <i class="material-icons label-icon">model_training</i>
                Model <span class="required">*</span>
              </label>
              <div class="input-wrapper">
                <input 
                  type="text" 
                  id="model"
                  class="form-control"
                  [class.is-invalid]="isFieldInvalid('model')"
                  [class.is-valid]="isFieldValid('model')"
                  formControlName="model"
                  placeholder="Enter model">
                <div class="input-icon" *ngIf="isFieldValid('model')">
                  <i class="material-icons">check</i>
                </div>
              </div>
              @if (isFieldInvalid('model')) {
                <div class="invalid-feedback">
                  <i class="material-icons">error</i>
                  {{ getFieldError('model') }}
                </div>
              }
            </div>

            <div class="form-group">
              <label for="serialNumber">
                <i class="material-icons label-icon">qr_code</i>
                Serial Number <span class="required">*</span>
              </label>
              <div class="input-wrapper">
                <input 
                  type="text" 
                  id="serialNumber"
                  class="form-control"
                  [class.is-invalid]="isFieldInvalid('serialNumber')"
                  [class.is-valid]="isFieldValid('serialNumber')"
                  formControlName="serialNumber"
                  placeholder="Enter serial number">
                <div class="input-icon" *ngIf="isFieldValid('serialNumber')">
                  <i class="material-icons">check</i>
                </div>
              </div>
              @if (isFieldInvalid('serialNumber')) {
                <div class="invalid-feedback">
                  <i class="material-icons">error</i>
                  {{ getFieldError('serialNumber') }}
                </div>
              }
            </div>

            <div class="form-group">
              <label for="rigNo">
                <i class="material-icons label-icon">construction</i>
                Rig No <span class="required">*</span>
              </label>
              <div class="input-wrapper">
                <input 
                  type="text" 
                  id="rigNo"
                  class="form-control"
                  [class.is-invalid]="isFieldInvalid('rigNo')"
                  [class.is-valid]="isFieldValid('rigNo')"
                  formControlName="rigNo"
                  placeholder="Enter rig number">
                <div class="input-icon" *ngIf="isFieldValid('rigNo')">
                  <i class="material-icons">check</i>
                </div>
              </div>
              @if (isFieldInvalid('rigNo')) {
                <div class="invalid-feedback">
                  <i class="material-icons">error</i>
                  {{ getFieldError('rigNo') }}
                </div>
              }
            </div>
            
            <div class="form-group">
              <label for="plateNo">
                <i class="material-icons label-icon">local_shipping</i>
                Plate No <span class="required">*</span>
              </label>
              <div class="input-wrapper">
                <input 
                  type="text" 
                  id="plateNo"
                  class="form-control"
                  [class.is-invalid]="isFieldInvalid('plateNo')"
                  [class.is-valid]="isFieldValid('plateNo')"
                  formControlName="plateNo"
                  placeholder="Enter plate number">
                <div class="input-icon" *ngIf="isFieldValid('plateNo')">
                  <i class="material-icons">check</i>
                </div>
              </div>
              @if (isFieldInvalid('plateNo')) {
                <div class="invalid-feedback">
                  <i class="material-icons">error</i>
                  {{ getFieldError('plateNo') }}
                </div>
              }
            </div>


            
            <div class="form-group">
              <label for="manufacturingYear">
                <i class="material-icons label-icon">calendar_today</i>
                Manufacturing Year <span class="required">*</span>
              </label>
              <div class="input-wrapper">
                <input 
                  type="number" 
                  id="manufacturingYear"
                  class="form-control"
                  [class.is-invalid]="isFieldInvalid('manufacturingYear')"
                  [class.is-valid]="isFieldValid('manufacturingYear')"
                  formControlName="manufacturingYear"
                  placeholder="Enter manufacturing year"
                  [min]="1900"
                  [max]="currentYear">
                <div class="input-icon" *ngIf="isFieldValid('manufacturingYear')">
                  <i class="material-icons">check</i>
                </div>
              </div>
              @if (isFieldInvalid('manufacturingYear')) {
                <div class="invalid-feedback">
                  <i class="material-icons">error</i>
                  {{ getFieldError('manufacturingYear') }}
                </div>
              }
            </div>

            <div class="form-group full-width">
              <label for="chassisDetails">
                <i class="material-icons label-icon">directions_car</i>
                Chassis Details <span class="required">*</span>
              </label>
              <div class="textarea-wrapper">
                <textarea 
                  id="chassisDetails"
                  class="form-control"
                  [class.is-invalid]="isFieldInvalid('chassisDetails')"
                  [class.is-valid]="isFieldValid('chassisDetails')"
                  formControlName="chassisDetails"
                  rows="3"
                  placeholder="Enter chassis details"></textarea>
                <div class="textarea-icon" *ngIf="isFieldValid('chassisDetails')">
                  <i class="material-icons">check</i>
                </div>
              </div>
              @if (isFieldInvalid('chassisDetails')) {
                <div class="invalid-feedback">
                  <i class="material-icons">error</i>
                  {{ getFieldError('chassisDetails') }}
                </div>
              }
            </div>
          </div>
        </div>
      </div>

      <!-- Form Summary -->
      <div class="form-summary">
        <div class="summary-stats">
          <div class="stat-item">
            <div class="stat-icon">
              <i class="material-icons">assignment_turned_in</i>
            </div>
            <div class="stat-content">
              <span class="stat-value">{{ getCompletionPercentage() }}%</span>
              <span class="stat-label">Complete</span>
            </div>
          </div>
          <div class="stat-item">
            <div class="stat-icon">
              <i class="material-icons">error</i>
            </div>
            <div class="stat-content">
              <span class="stat-value">{{ getTotalErrors() }}</span>
              <span class="stat-label">Errors</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Form Actions -->
      <div class="form-actions">
        <button 
          type="button" 
          class="cancel-btn" 
          (click)="onCancel()"
          [disabled]="isSubmitting">
          <i class="material-icons">close</i>
          Cancel
        </button>
        <button 
          type="submit" 
          class="save-btn"
          [disabled]="machineForm.invalid || isSubmitting">
          @if (isSubmitting) {
            <div class="loading-spinner"></div>
            <span class="loading-text">Adding Machine...</span>
          } @else {
            <i class="material-icons">add</i>
            Add Machine
          }
        </button>
      </div>
    </form>
  </div>
</div>
